<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>CIKM Data Challenge Leaderboard</title>
    <link rel="stylesheet" href="style.css">
    <script src="https://www.google.com/recaptcha/api.js" async defer></script>
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"
            integrity="sha256-/xUj+3OJU5yExlq6GSYGSHk7tPXikynS7ogEvDej/m4=" crossorigin="anonymous"></script>
    <!-- Favicon-->
    <link href="https://cdn.datatables.net/1.10.20/css/dataTables.bootstrap4.min.css" rel="stylesheet">
    <link rel="icon" type="image/x-icon" href="assets/favicon.ico"/>
    <!-- Font Awesome icons (free version)-->
    <script src="https://use.fontawesome.com/releases/v6.1.0/js/all.js" crossorigin="anonymous"></script>
    <!-- Google fonts-->
    <link href="https://fonts.googleapis.com/css?family=Montserrat:400,700" rel="stylesheet" type="text/css"/>
    <link href="https://fonts.googleapis.com/css?family=Roboto+Slab:400,100,300,700" rel="stylesheet" type="text/css"/>
    <!-- Core theme CSS (includes Bootstrap)-->
    <link href="css/styles.css" rel="stylesheet"/>
    <script src="https://cdn.datatables.net/1.10.20/js/jquery.dataTables.min.js"></script>
    <script src="https://cdn.datatables.net/1.10.20/js/dataTables.bootstrap4.min.js"></script>


</head>


<script>
    var ENDPOINT_URL = 'https://usb3d4wvp3.execute-api.us-west-2.amazonaws.com/dev/leaderboard_v2';
    var TABLE_INFO = [{
        'task': 'evalRS',
        'tableBodyId': 'evalRSTableBody',
        'tableId': 'evalRSTable',
        'metrics': [
            "score", "hit_rate", "mrr", "mred_country", "mred_user_activity", "mred_track_popularity",
            "mred_artist_popularity", "mred_gender", "being_less_wrong", "latent_diversity"
        ],
        'metric_to_title_mapping':{
            "score":"Score",
            "hit_rate": "Hit Rate",
            "mrr": "MRR",
            "mred_country": "Country (MRED)",
            "mred_track_popularity": "Track Pop. (MRED)",
            "mred_artist_popularity": "Artist Pop. (MRED)",
            "mred_user_activity": "User Act. (MRED)",
            "mred_gender": "Gender (MRED)",
            "being_less_wrong": "Being Less Wrong",
            "latent_diversity": "Latent Diversity"
        }
    }]
    var url = new URL(window.location.href)
    var url_params = new URLSearchParams(url.search)

    function initLeaderboardTable(tableInfo) {
        var metrics = '';
        for (var i=0; i<tableInfo['metrics'].length; i++){
            metrics += '<th style="text-align:center">' + tableInfo['metric_to_title_mapping'][tableInfo['metrics'][i]] + '</th>'
        }
        var htmlBody = ' <div class="table-responsive">\
                            <table id="tableexample" class="table table-striped">\
                            <thead>\
                                <th style="text-align:center">  # </th>\
                                <th style="text-align:center"> Name </th>'
                                + metrics +
                                '<th style="text-align:center;white-space: nowrap">&nbsp&nbsp&nbsp Date &nbsp&nbsp&nbsp</th>\
                            </thead>\
                            <tbody id=' + tableInfo['tableBodyId'] + '>\
                            </tbody>\
                            </table> </div>'
        console.log(htmlBody)
        $('#' + tableInfo['tableId']).html(htmlBody);
    }


    // function to build rows for the submissions in a given table body
    function buildLeaderboardTable(data, targetTable, metrics, t) {
        var htmlBody = '';
        var rows = data.data;
        for (var i = 0; i < rows.length; i++) {
            metric_vals = []
            for (var j=0; j < metrics.length; j++){
                metric_vals.push(rows[i]['metrics'][metrics[j]])
            }
            let row_data = [rows[i]['#'], rows[i]['info']['nickname'], ...metric_vals, rows[i]['info']['submission_time']]
            // console.log(row_data)
            t.row.add(row_data).draw()
            // OLD MANUAL WAY
            // // start row
            // htmlBody += '<tr>';
            // htmlBody += '<td style="text-align:center">' + rows[i]['#'] + '</td>';
            // htmlBody += '<td style="text-align:center">' + rows[i]['info']['nickname'] + '</td>';
            // for (var j=0; j < metrics.length; j++){
            //     htmlBody += '<td style="text-align:center">' + rows[i]['metrics'][metrics[j]] + '</td>';
            // }
            // htmlBody += '<td style="text-align:center">' + rows[i]['info']['submission_time'] + '</td>';
            // // end row
            // htmlBody += '</tr>';
        }
        // finally, fill the table
        // console.log(targetTable)
        // console.log(htmlBody)
        // $('#' + targetTable).html(htmlBody);
    }

    function sign_up_success() {
        alert("Sign-Up Successful!");
    }

    function sign_up_failure() {
        alert("Sign-Up Unsuccessful!");
    }

    function check_success(params) {
        if (params.has('success') && params.get('success') === 'True') {
            sign_up_success();
        } else if (params.has('success') && params.get('success') === 'False') {
            sign_up_failure();
        }
    }

    // on page load, call the endpoint
    $(document).ready(function () {
        check_success(url_params)
        // generate tables
        TABLE_INFO.forEach(initLeaderboardTable)
        // make into datatable obj
        let TABLE = $('#tableexample').DataTable();
        // put info into tables

        TABLE_INFO.forEach(tableInfo =>
            $.get(ENDPOINT_URL, {limit: 10, task: tableInfo['task']})
                // when done
                .done(function (data) {
                    console.log("Data Loaded: " + JSON.stringify(data));
                    buildLeaderboardTable(data, tableInfo['tableBodyId'], tableInfo['metrics'], TABLE);
                }) // when something happens
                .fail(function (data) {
                    alert("ERROR WHEN CALLING THE LEADERBOARD ENDPOINT");
                })
        );

    });

    // captcha
    function enableBtn() {
        document.getElementById("signBtn").disabled = false;
    }

    // trick from: https://artisansweb.net/validate-google-recaptcha-using-javascript/
    function submitUserForm() {
        var response = grecaptcha.getResponse();
        if (response.length == 0) {
            alert("CAPTCHA ERROR!");
            return false;
        }
        return true;
    }
</script>


<body id="page-top">
<header class="masthead">
    <div class="container">
        <div class="masthead-subheading">EvalRS</div>
        <div class="masthead-heading text-uppercase">A Rounded Evaluation of Recommender Systems</div>
    </div>
</header>
<nav class="navbar navbar-expand-lg navbar-dark fixed-top" id="mainNav">
    <div class="container">
        <a class="navbar-brand" target="_blank" href="https://github.com/RecList/evalRS-CIKM-2022">EvalRS</a>
        <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarResponsive"
                aria-controls="navbarResponsive" aria-expanded="false" aria-label="Toggle navigation">
            Menu
            <i class="fas fa-bars ms-1"></i>
        </button>
        <div class="collapse navbar-collapse" id="navbarResponsive">
            <ul class="navbar-nav text-uppercase ms-auto py-4 py-lg-0">
                <li class="nav-item"><a class="nav-link" href="https://reclist.io/cikm2022-cup#services">Challenge</a></li>
                <li class="nav-item"><a class="nav-link" href="https://reclist.io/cikm2022-cup#prize">Prize</a></li>
                <li class="nav-item"><a class="nav-link" href="https://reclist.io/cikm2022-cup#dates">Important Dates</a></li>
                <li class="nav-item"><a class="nav-link" href="https://reclist.io/cikm2022-cup#organizers">Organizers</a></li>
            </ul>
        </div>
    </div>
</nav>
<!-- Masthead-->


<section class="page-section" id="instructions">
    <div id="container" class="container">
        <div class="row">
            <div class="col-md-12">
                <div id="overview">
                    <div class="text-center">
                        <h1 class="section-heading text-uppercase">CIKM DATA CHALLENGE 2022</h1>
                    </div>
                    <p>
                        Training data, evaluation scripts and rules can be found in the
                        <a target="_blank" href="https://github.com/RecList/evalRS-CIKM-2022">official challenge
                            repository</a>;
                        relevant literature and background information about the challenge and relevant industry use
                        cases can
                        be found in the <a href="https://arxiv.org/abs/2207.05772"> challenge paper pre-print</a>.
                    </p>
                </div>
            </div>
        </div>

    </div>
    <div class="container">
    <div class="row">
        <div id="signupContainer">
            <h2>Sign-up</h2>
            <p>
                To sign up for the challenge, you should fill the form below with your official e-mail, your
                organization
                (university or company), first and last name of the team lead and a nickname for the leaderboard.
                You will receive a confirmation e-mail from the system including your user id and AWS write-only
                credentials
                to upload your json files to the challenge bucket - please use the information responsibly. After
                submitting the form, you will be sent back to this page: please <b>wait some minutes and re-check your
                e-mail,
                <em>including your spam folder</em></b> before re-submitting. We suggest adding
                <em>evalrs2022@gmail.com</em>
                to your list of trusted senders.
            </p>
            <p>
                This web-app is hosted on a devoted AWS account and all data will be destroyed at the end of the Data
                Challenge:
                if you want to use the same serverless back-end to run a lightweight leaderboard website, please get in
                touch.
            </p>
            <p>
                For the submission format and the general rules of the contest,
                please consult the relevant section in the
                <a target="_blank" href="https://github.com/RecList/evalRS-CIKM-2022">README</a>
            </p>
            <div align="center">
                <form action="https://usb3d4wvp3.execute-api.us-west-2.amazonaws.com/dev/signup" method="POST"
                      onsubmit="return submitUserForm();">
                    <table>
                        <tr>
                            <td align="right"><label for="fname">First Name</label></td>
                            <td align="left"><input type="text" id="fname" name="fname" placeholder="Tony"></td>
                        </tr>
                        <tr>
                            <td align="right"><label for="lname">Last Name</label></td>
                            <td align="left"><input type="text" id="lname" name="lname" placeholder="Stark"></td>
                        </tr>
                        <tr>
                            <td align="right"><label for="nickname">Nickname</label></td>
                            <td align="left"><input type="text" id="nickname" name="nickname" placeholder="Ironman">
                            </td>
                        </tr>
                        <tr>
                            <td align="right"><label for="email">E-mail</label></td>
                            <td align="left"><input type="text" id="email" name="email"
                                                    placeholder="tony@starkindustries.com"></td>
                        </tr>
                        <tr>
                            <td align="right"><label for="organization">Organization</label></td>
                            <td align="left"><input type="text" id="organization" name="organization"
                                                    placeholder="Stark Industries"></td>
                        </tr>
                    </table>
                    <div class="g-recaptcha" data-sitekey="6LfKDhIhAAAAANZmfgQ9JIkcTPnn71DyleqTLLxD"
                         data-callback="enableBtn"></div>
                    <br/>
                    <input type="submit" value="Submit" id="signBtn" disabled="disabled" class="submitBtn">
                </form>
            </div>
        </div> <!-- end of sign up -->
        <div id="leaderboardContainer">
            <div class="taskContainer">
                <h2>EvalRS Leaderboard</h2>
                <div class="boardContainer" id="evalRSTable"></div>
                <!--                <h2>Subsequent Items Prediction Leaderboard</h2>-->
                <!--                <div class="boardContainer" id="recAllTable"></div>-->
                <!--                <h2>Purchase Intent Prediction Leaderboard</h2>-->
                <!--                <div class="boardContainer" id="cartTable"></div>-->
            </div> <!-- end of container with NEP task -->
        </div> <!-- end of leaderboards -->
    </div> <!-- end of all page container -->
    </div>
</section>
</body>

<!-- Bootstrap core JS-->
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/js/bootstrap.bundle.min.js"></script>



<!-- Core theme JS-->
<script src="js/scripts.js"></script>
<!-- * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * *-->
<!-- * *                               SB Forms JS                               * *-->
<!-- * * Activate your form at https://startbootstrap.com/solution/contact-forms * *-->
<!-- * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * *-->
<script src="https://cdn.startbootstrap.com/sb-forms-latest.js"></script>
</html>